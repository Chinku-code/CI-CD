.helm_update:
   stage: deploy
   image: registry.dev.sbiepay.sbi:8443/ubi9/ochelm:03122024
   script:
     - oc login "$OPENSHIFT_SERVER" --token="$OPENSHIFT_TOKEN" --insecure-skip-tls-verify
     - oc project $NAMESPACE
     - cd ./$ENV/charts/
     - sed -i "s/\(tag:\).*/\1 \"${VERSION}\"/" $SERVICE/values.yaml
     - helm upgrade --install $RELEASE -f $SERVICE/values.yaml   $SERVICE/
     - oc rollout restart deployment $RELEASE-$CHART
     - oc get all | grep $RELEASE
   parallel:
    matrix:
      - SERVICE: "epay_transaction_service"
        NAMESPACE: "dev-transaction"
        CHART: "transactionservice"
        RELEASE: "txn"
        ENVIRONMENT: "dev"
      - SERVICE: "epay_admin_service"
        NAMESPACE: "dev-admin"
        CHART: "adminservice"
        RELEASE: "admin"
        ENVIRONMENT: "dev"
     # - SERVICE: "epay_admin_service_preprod"
     #   NAMESPACE: "devops-admin"
     #   CHART: "adminservice"
     #   RELEASE: "admin"
     #   ENVIRONMENT: "dev"
      - SERVICE: "epay_key_managment"
        NAMESPACE: "dev-kms"
        CHART: "kmsservice"
        RELEASE: "kms"
        ENVIRONMENT: "dev"
      - SERVICE: "epay_merchant_service"
        NAMESPACE: "dev-merchant"
        CHART: "merchantservice"
        RELEASE: "merchant"
        ENVIRONMENT: "dev"
      - SERVICE: "epay_payment_service"
        NAMESPACE: "dev-transaction"
        CHART: "paymentservice"
        RELEASE: "payment"
        ENVIRONMENT: "dev"
      - SERVICE: "epay_stubs_service"
        NAMESPACE: "dev-transaction"
        CHART: "stubsservice"
        RELEASE: "stubs"
        ENVIRONMENT: "dev"
      - SERVICE: "epay_reports_service"
        NAMESPACE: "dev-merchant"
        CHART: "reportservice"
        RELEASE: "report"
        ENVIRONMENT: "dev"
      - SERVICE: "epay_refund_service"
        NAMESPACE: "dev-rns"
        CHART: "refundservice"
        RELEASE: "refund"
        ENVIRONMENT: "dev"
      - SERVICE: "epay_sftp_service"
        NAMESPACE: "dev-rns"
        CHART: "sftpservice"
        RELEASE: "sftp"
        ENVIRONMENT: "dev"
      - SERVICE: "epay_recon_settlement_service"
        NAMESPACE: "dev-rns"
        CHART: "reconsettlementservice"
        RELEASE: "rns"
        ENVIRONMENT: "dev"
      - SERVICE: epay_merchant_fe
        NAMESPACE: dev-frontend
        CHART: merchant-frontend
        RELEASE: merchantfe
        ENVIRONMENT: dev
      - SERVICE: epay_transaction_fe
        NAMESPACE: dev-frontend
        CHART: transaction-frontend
        RELEASE: transactionfe
        ENVIRONMENT: dev
      - SERVICE: java-utility-api-simulator
        NAMESPACE: dev-simulators
        CHART: javautilityapisimulator
        RELEASE: javasimulator
        ENVIRONMENT: dev
      - SERVICE: merchant-api-simulator-nodejs
        NAMESPACE: dev-simulators
        CHART: merchant-api-simulator-nodejs
        RELEASE: nodejssimulator
        ENVIRONMENT: dev
      - SERVICE: merchant-api-simulator-python
        NAMESPACE: dev-simulators
        CHART: merchant-api-simulator-python
        RELEASE: pythonsimulator
        ENVIRONMENT: dev
      - SERVICE: merchant-api-simulator-dotnet
        NAMESPACE: dev-simulators
        CHART: merchant-api-simulator-dotnet
        RELEASE: dotnetsimulator
        ENVIRONMENT: dev 
      - SERVICE: merchant-api-simulator-php
        NAMESPACE: dev-simulators
        CHART: merchant-api-simulator-php
        RELEASE: phpsimulator
        ENVIRONMENT: dev 
      - SERVICE: epay_gateway_pooling
        NAMESPACE: dev-offline-jobs
        CHART: gatewaypooling
        RELEASE: pooling
        ENVIRONMENT: dev  
      - SERVICE: epay_order_hash
        NAMESPACE: dev-simulators
        CHART: orderhash
        RELEASE: orderhash
        ENVIRONMENT: dev    
      - SERVICE: "epay_transaction_service"
        NAMESPACE: "sit-transaction"
        CHART: "transactionservice"
        RELEASE: "txn"
        ENVIRONMENT: "sit"
      - SERVICE: "epay_admin_service"
        NAMESPACE: "sit-admin"
        CHART: "adminservice"
        RELEASE: "admin"
        ENVIRONMENT: "sit"
      - SERVICE: "epay_key_managment"
        NAMESPACE: "sit-kms"
        CHART: "kmsservice"
        RELEASE: "kms"
        ENVIRONMENT: "sit"
      - SERVICE: "epay_merchant_service"
        NAMESPACE: "sit-merchant"
        CHART: "merchantservice"
        RELEASE: "merchant"
        ENVIRONMENT: "sit"
      - SERVICE: "epay_payment_service"
        NAMESPACE: "sit-transaction"
        CHART: "paymentservice"
        RELEASE: "payment"
        ENVIRONMENT: "sit"
      - SERVICE: "epay_reports_service"
        NAMESPACE: "sit-merchant"
        CHART: "reportservice"
        RELEASE: "report"
        ENVIRONMENT: "sit"
      - SERVICE: epay_merchant_fe
        NAMESPACE: sit-frontend
        CHART: merchant-frontend
        RELEASE: merchantfe
        ENVIRONMENT: sit
      - SERVICE: epay_transaction_fe
        NAMESPACE: sit-frontend
        CHART: transaction-frontend
        RELEASE: transactionfe
        ENVIRONMENT: sit
      - SERVICE: java-utility-api-simulator
        NAMESPACE: sit-simulators
        CHART: javautilityapisimulator
        RELEASE: javasimulator
        ENVIRONMENT: sit 
      - SERVICE: merchant-api-simulator-nodejs
        NAMESPACE: sit-simulators
        CHART: merchant-api-simulator-nodejs
        RELEASE: nodejssimulator
        ENVIRONMENT: sit 
      - SERVICE: "epay_transaction_service"
        NAMESPACE: "uat-transaction"
        CHART: "transactionservice"
        RELEASE: "txn"
        ENVIRONMENT: "uat"
      - SERVICE: "epay_admin_service"
        NAMESPACE: "uat-admin"
        CHART: "adminservice"
        RELEASE: "admin"
        ENVIRONMENT: "uat"
      - SERVICE: "epay_key_managment"
        NAMESPACE: "uat-kms"
        CHART: "kmsservice"
        RELEASE: "kms"
        ENVIRONMENT: "uat"
      - SERVICE: "epay_merchant_service"
        NAMESPACE: "uat-merchant"
        CHART: "merchantservice"
        RELEASE: "merchant"
        ENVIRONMENT: "uat"
      - SERVICE: "epay_payment_service"
        NAMESPACE: "uat-transaction"
        CHART: "paymentservice"
        RELEASE: "payment"
        ENVIRONMENT: "uat"
      - SERVICE: "epay_reports_service"
        NAMESPACE: "uat-merchant"
        CHART: "reportservice"
        RELEASE: "report"
        ENVIRONMENT: "uat"
      - SERVICE: epay_merchant_fe
        NAMESPACE: uat-frontend
        CHART: merchant-frontend
        RELEASE: merchantfe
        ENVIRONMENT: uat
      - SERVICE: epay_transaction_fe
        NAMESPACE: uat-frontend
        CHART: transaction-frontend
        RELEASE: transactionfe
        ENVIRONMENT: uat
      - SERVICE: java-utility-api-simulator
        NAMESPACE: uat-simulators
        CHART: javautilityapisimulator
        RELEASE: javasimulator
        ENVIRONMENT: uat  
      - SERVICE: "epay_admin_service"
        NAMESPACE: "preprod-admin"
        CHART: "adminservice"
        RELEASE: "admin"
        ENVIRONMENT: "pre-prod"     
   rules:
    - if: $SERVICE_NAME == $SERVICE && $ENV == $ENVIRONMENT && $CI_PIPELINE_SOURCE == "pipeline"
